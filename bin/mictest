#!/bin/bash

set -xe

FILE=$(tempfile --prefix=record)
NOISE=$(tempfile --prefix=noise)
NOISE_PROF=$(tempfile --prefix=noiseprofile)

# Record some noise
arecord -f dat --duration 1 | sox -t wav -b 16 -r 44100 -e signed - -t wav $NOISE
# Profile noise
sox $NOISE -n noiseprof $NOISE_PROF

arecord \
	--vumeter mono \
	--format dat \
	--duration 5 \
	$FILE

sox -t wav -b 16 -r 44100 -e signed $FILE -t wav - noisered $NOISE_PROF 0.21 | play -

rm $FILE $NOISE $NOISE_PROF
